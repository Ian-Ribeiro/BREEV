{% load static %}
{% load livereload_tags %}
{% load form_filters %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cadastro</title>
	<!-- Bootstrap 5 via CDN: fornece estilos e componentes usados no template -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Arquivo CSS estático do projeto -->
	<link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="dark d-flex align-items-center justify-content-center vh-100">

	<!-- Container principal do formulário: card centralizado com largura máxima -->
	<div class="card shadow-sm p-4" style="width: 100%; max-width: 420px;">
		<h1 class="h4 mb-4 text-center">Cadastro</h1>

		<!-- Mensagens do Django (success, error, info, etc).
			 'messages' é passado no contexto pela view; aqui iteramos e exibimos cada uma. -->
		{% if messages %}
			<div>
				{% for message in messages %}
					<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
						{{ message }}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				{% endfor %}
			</div>
		{% endif %}

		<!-- Exibe erros não vinculados a campos (ex.: passwords não conferem) -->
		{% if form.non_field_errors %}
			<div class="alert alert-danger">
				{{ form.non_field_errors }}
			</div>
		{% endif %}

		<!-- Formulário de cadastro:
			 - method="post" para submissão segura
			 - {% csrf_token %} protege contra CSRF (obrigatório em forms POST no Django) -->
		<form method="post" novalidate>
			{% csrf_token %}

			<!-- Campo username:
				 - label_tag: renderiza a tag <label> do campo
				 - add_class (filter personalizado) adiciona a classe Bootstrap ao widget
				 - .errors exibe erros de validação específicos do campo -->
			<div class="mb-3">
				{{ form.username.label_tag }}
				{{ form.username|add_class:"form-control" }}
				{% if form.username.help_text %}
					<small class="form-text text-muted">{{ form.username.help_text }}</small>
				{% endif %}
				{% for err in form.username.errors %}
					<div class="invalid-feedback d-block">{{ err }}</div>
				{% endfor %}
			</div>

			<!-- Campo email -->
			<div class="mb-3">
				{{ form.email.label_tag }}
				{{ form.email|add_class:"form-control" }}
				{% if form.email.help_text %}
					<small class="form-text text-muted">{{ form.email.help_text }}</small>
				{% endif %}
				{% for err in form.email.errors %}
					<div class="invalid-feedback d-block">{{ err }}</div>
				{% endfor %}
			</div>

			<!-- Campo password: geralmente renderiza um <input type="password"> -->
			<div class="mb-3">
				{{ form.password.label_tag }}
				<div class="input-group">
					{{ form.password|add_class:"form-control" }}
					<button type="button" class="btn btn-outline-secondary" id="togglePassword" aria-label="Mostrar senha">Mostrar</button>
				</div>
				{% if form.password.help_text %}
					<small class="form-text text-muted">{{ form.password.help_text }}</small>
				{% endif %}
				{% for err in form.password.errors %}
					<div class="invalid-feedback d-block">{{ err }}</div>
				{% endfor %}
			</div>

			<!-- Campo confirmação de senha -->
			<div class="mb-3">
				{{ form.password_confirm.label_tag }}
				{{ form.password_confirm|add_class:"form-control" }}
				{% if form.password_confirm.help_text %}
					<small class="form-text text-muted">{{ form.password_confirm.help_text }}</small>
				{% endif %}
				{% for err in form.password_confirm.errors %}
					<div class="invalid-feedback d-block">{{ err }}</div>
				{% endfor %}
			</div>

			<!-- Botão de submissão: usa utilitário d-grid para stretch -->
			<div class="d-grid">
				<button type="submit" class="btn btn-primary">Registrar</button>
			</div>
		</form>

		<!-- Link de navegação para voltar à página inicial -->
		<div class="mt-3 text-start">
			<a href="{% url 'home' %}" class="text-decoration-none text-primary">← Voltar</a>
		</div>
	</div>

	<!-- livereload: tag adicionada pelo pacote de desenvolvimento para recarregar automaticamente -->
	{% livereload_script %}
	<!-- Script do Bootstrap-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Pequeno script de usabilidade: foco automático e toggle de senha -->
	<script>
		// foco no primeiro campo do formulário
		(function(){ var el = document.querySelector('form input'); if(el) el.focus(); })();

		// toggle para campos de senha (usa ids padrão gerados pelo Django: id_password, id_password_confirm)
		(function(){
			var btn = document.getElementById('togglePassword');
			if(!btn) return;
			btn.addEventListener('click', function(){
				['id_password','id_password_confirm'].forEach(function(id){
					var f = document.getElementById(id);
					if(f) f.type = f.type === 'password' ? 'text' : 'password';
				});
				this.textContent = this.textContent === 'Mostrar' ? 'Ocultar' : 'Mostrar';
			});
		})();
	</script>
</body>
</html>